name: Haber Botu SayfasÄ±nÄ± OluÅŸtur ve YayÄ±nla

on:
  schedule:
    # BetiÄŸi her 30 dakikada bir Ã§alÄ±ÅŸtÄ±rÄ±r (UTC zaman dilimine gÃ¶re)
    - cron: '*/30 * * * *'
  push:
    branches:
      - main  # Veya varsayÄ±lan ÅŸubenizin adÄ± (Ã¶rn: master)
  workflow_dispatch: # GitHub Actions sekmesinden manuel olarak Ã§alÄ±ÅŸtÄ±rmayÄ± saÄŸlar

permissions: # <- BU SATIRI EKLEYÄ°N
  contents: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest # Ä°ÅŸ akÄ±ÅŸÄ±nÄ±n Ã§alÄ±ÅŸacaÄŸÄ± sanal ortam

    steps:
      - name: Depoyu Kopyala ğŸ›ï¸
        uses: actions/checkout@v4 # Kodunuzu sanal ortama Ã§eker

      - name: Python Kurulumu ğŸ
        uses: actions/setup-python@v4
        with:
          python-version: '3.13' # BetiÄŸinizin uyumlu olduÄŸu Python sÃ¼rÃ¼mÃ¼nÃ¼ belirtin

      - name: Pip Ã¶nbelleÄŸini yÃ¼kle âš¡
        uses: actions/cache@v4
        with:
          path: ~/.cache/pip
          key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
          restore-keys: |
            ${{ runner.os }}-pip-

      - name: BaÄŸÄ±mlÄ±lÄ±klarÄ± YÃ¼kle âš™ï¸
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
          # Selenium ve Chrome iÃ§in gerekli sistem paketleri (Ubuntu iÃ§in)
          sudo apt-get update
          sudo apt-get install -y google-chrome-stable chromium-chromedriver libglib2.0-0 libnss3 libfontconfig1

      - name: GitHub Secrets'tan .env DosyasÄ± OluÅŸtur ğŸ¤«
        run: |
          echo "API_KEY=${{ secrets.API_KEY }}" > .env
          echo "API_SECRET=${{ secrets.API_SECRET }}" >> .env
          echo "ACCESS_TOKEN=${{ secrets.ACCESS_TOKEN }}" >> .env
          echo "ACCESS_SECRET=${{ secrets.ACCESS_SECRET }}" >> .env
          echo "BEARER_TOKEN=${{ secrets.BEARER_TOKEN }}" >> .env
          echo "OPENWEATHER_API_KEY=${{ secrets.OPENWEATHER_API_KEY }}" >> .env
          # echo "GITHUB_USERNAME=${{ secrets.GITHUB_USERNAME }}" >> .env
          # GITHUB_TOKEN genellikle ${{ secrets.GITHUB_TOKEN }} olarak doÄŸrudan kullanÄ±lÄ±r, .env'e yazmak gerekmeyebilir.
          # EÄŸer betiÄŸinizin .env'den okumasÄ± gerekiyorsa ekleyebilirsiniz:
          # echo "GITHUB_TOKEN=${{ secrets.ACTION_SPECIFIC_GITHUB_TOKEN }}" >> .env # Ã–zel bir token ise
          echo "OPENAI_API_KEY=${{ secrets.OPENAI_API_KEY }}" >> .env
          echo "SPOTIFY_CLIENT_ID=${{ secrets.SPOTIFY_CLIENT_ID }}" >> .env
          echo "SPOTIFY_CLIENT_SECRET=${{ secrets.SPOTIFY_CLIENT_SECRET }}" >> .env
          echo "SPOTIFY_REFRESH_TOKEN=${{ secrets.SPOTIFY_REFRESH_TOKEN }}" >> .env
          echo "SPOTIFY_USER_ID=${{ secrets.SPOTIFY_USER_ID }}" >> .env
          echo "SPOTIFY_TARGET_PLAYLIST_ID=${{ secrets.SPOTIFY_TARGET_PLAYLIST_ID }}" >> .env
          echo "TMDB_API_KEY=${{ secrets.TMDB_API_KEY }}" >> .env
          echo "âœ… .env dosyasÄ± GitHub Secrets kullanÄ±larak oluÅŸturuldu."

      - name: Dosya YollarÄ±nÄ± Listele (Hata AyÄ±klama Ä°Ã§in)
        run: |
          pwd
          ls -R
          # ls -R $GITHUB_WORKSPACE # GITHUB_WORKSPACE iÃ§ini de listeleyebilirsiniz

      - name: Haber Botu BetiÄŸini Ã‡alÄ±ÅŸtÄ±r ğŸ¤–
        working-directory: ./ 
        run: python main.py



      - name: GitHub Pages'e DaÄŸÄ±t ğŸš€
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }} # GitHub tarafÄ±ndan otomatik saÄŸlanÄ±r
          publish_dir: ./output  # haberler.html dosyasÄ±nÄ±n oluÅŸturulduÄŸu klasÃ¶r
          # publish_branch: gh-pages # VarsayÄ±lan olarak 'gh-pages' ÅŸubesine yayÄ±nlar
          # user_name: 'github-actions[bot]' # Commit yapan kullanÄ±cÄ± adÄ± (isteÄŸe baÄŸlÄ±)
          # user_email: 'github-actions[bot]@users.noreply.github.com' # Commit yapan e-posta (isteÄŸe baÄŸlÄ±)
          # commit_message: 'OluÅŸturulan HTML sayfasÄ±nÄ± yayÄ±nla' # Commit mesajÄ± (isteÄŸe baÄŸlÄ±)
          # cname: ozelalanadiniz.com # EÄŸer Ã¶zel bir alan adÄ±nÄ±z varsa